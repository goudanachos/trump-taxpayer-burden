<!-- CLASSIFICATION FILE - Government Document Format with Mobile Accordion -->
<details class="expenditure-card" style="background: var(--color-bg-primary); border: var(--border-authority); margin-bottom: var(--space-lg); box-shadow: 0 4px 16px rgba(0,0,0,0.1); position: relative; overflow: hidden; border-radius: 8px;">
    
    <!-- Collapsed Summary (One-line) -->
    <summary class="expenditure-summary" style="padding: 16px 24px; cursor: pointer; min-height: 48px; display: flex; align-items: center; justify-content: space-between; list-style: none; position: relative;" tabindex="0">
        <!-- Mobile: Single column grid for collapsed state -->
        <div style="display: grid; grid-template-columns: 1fr auto; gap: 16px; align-items: center; width: 100%;">
            <div>
                <!-- Date and Location Combined -->
                <div class="mobile-title-case" style="font-size: clamp(14px, 4vw, 16px); color: var(--color-text-primary); font-weight: 600; margin-bottom: 4px;">
                    {{ expenditure.date | date: "%B %-d" }} â€¢ {{ expenditure.location | truncate: 50 }}
                </div>
                <div style="font-size: clamp(12px, 3vw, 14px); color: var(--color-text-secondary);">
                    {{ expenditure.activities.size }} {% if expenditure.activities.size == 1 %}activity{% else %}activities{% endif %}
                </div>
            </div>
            
            <!-- Price Pill (positioned inside card edge) -->
            {% assign pill_cost_text = expenditure.total_cost | currency %}
            {% assign pill_cost_length = pill_cost_text | size %}
            {% if pill_cost_length <= 8 %}
                {% assign pill_cost_class = "cost-short" %}
            {% elsif pill_cost_length <= 12 %}
                {% assign pill_cost_class = "cost-medium" %}
            {% else %}
                {% assign pill_cost_class = "cost-long" %}
            {% endif %}
            <div class="price-pill {{ pill_cost_class }}" style="background: var(--color-text-alert); color: white; padding: 8px 12px; border-radius: 20px; font-weight: 700; box-shadow: 0 2px 8px rgba(220,20,60,0.3); white-space: nowrap;">
                {{ pill_cost_text }}
            </div>
        </div>
        
        <!-- Chevron indicator -->
        <svg class="chevron" width="12" height="12" viewBox="0 0 24 24" fill="currentColor" style="color: var(--color-text-secondary); transition: transform 0.25s ease; margin-left: 8px;">
            <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
        </svg>
    </summary>
    
    <!-- Expanded Details (Lazy-loaded content) -->
    <div class="expenditure-details">
        <div style="padding: 0 24px 24px;">
            <!-- Document Header (Full version) -->
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px; border-bottom: 1px solid var(--color-neutral-200); padding-bottom: 16px;">
                <div style="flex: 1;">
                    <!-- Classification Stamps -->
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; flex-wrap: wrap;">
                        <div style="display: inline-block; background: var(--color-bg-secondary); border: 1px solid var(--color-text-secondary); padding: 4px 8px;">
                            <div class="classification-font" style="color: var(--color-text-secondary); font-size: 10px; letter-spacing: 0.1em;">
                                UNCLASSIFIED
                            </div>
                        </div>
                        {% if expenditure.confidence_level %}
                        <div style="display: inline-block; background: var(--color-bg-secondary); border: 1px solid var(--color-text-secondary); padding: 4px 8px;">
                            <div class="classification-font" style="color: var(--color-text-secondary); font-size: 10px; letter-spacing: 0.1em;">
                                CONFIDENCE: {{ expenditure.confidence_level | upcase }}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    
                    <!-- Date Stamp -->
                    <div class="classification-font mobile-title-case" style="color: var(--color-text-secondary); font-size: clamp(12px, 3vw, 14px); margin-bottom: 4px;">
                        Date: {{ expenditure.date }}
                    </div>
                    
                    <!-- Location - Primary Identifier -->
                    <h2 class="command-font mobile-title-case" style="color: var(--color-text-primary); font-size: clamp(16px, 4vw, 20px); margin: 0;">
                        {{ expenditure.location }}
                    </h2>
                </div>
                
                <!-- Cost Alert Panel (Mobile optimized) -->
                <div style="background: var(--color-bg-secondary); border: 2px solid var(--color-text-alert); padding: 12px; min-width: 140px; text-align: center;">
                    <div class="standard-font mobile-title-case" style="color: var(--color-text-secondary); font-size: clamp(10px, 2.5vw, 12px); margin-bottom: 4px; letter-spacing: 0.05em;">
                        Total Expenditure
                    </div>
                    {% assign details_cost_text = expenditure.total_cost | currency %}
                    {% assign details_cost_length = details_cost_text | size %}
                    {% if details_cost_length <= 8 %}
                        {% assign details_cost_class = "cost-short" %}
                    {% elsif details_cost_length <= 12 %}
                        {% assign details_cost_class = "cost-medium" %}
                    {% else %}
                        {% assign details_cost_class = "cost-long" %}
                    {% endif %}
                    <div class="classification-font {{ details_cost_class }}" style="color: var(--color-text-alert); font-weight: 700; line-height: 1;">
                        {{ details_cost_text }}
                    </div>
                </div>
            </div>

            <!-- Activity Breakdown - Mobile Grid -->
            <div style="margin-bottom: 16px;">
                <div class="standard-font mobile-title-case" style="color: var(--color-text-primary); font-size: clamp(12px, 3vw, 14px); margin-bottom: 8px; font-weight: 600;">
                    Itemized Breakdown:
                </div>
                
                {% for activity in expenditure.activities %}
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: clamp(8px, 2vw, 16px); padding: 12px 0; border-bottom: 1px solid var(--color-neutral-200); align-items: start;">
                        <div>
                            <div class="standard-font mobile-title-case" style="color: var(--color-text-primary); font-size: clamp(14px, 3.5vw, 16px); font-weight: 500; margin-bottom: 4px;">
                                {% if activity.name contains 'No leisure' or activity.name contains 'NO LEISURE' %}
                                    No Taxpayer-Funded Leisure Activities
                                {% else %}
                                    {{ activity.name }}
                                {% endif %}
                            </div>
                            <div class="standard-font" style="color: var(--color-text-secondary); font-size: clamp(12px, 3vw, 14px); line-height: 1.4;">
                                {% if activity.name contains 'No leisure' or activity.name contains 'NO LEISURE' %}
                                    All reported activities were official government business. No personal travel, golf, or recreational activities at private properties incurred taxpayer costs.
                                {% else %}
                                    {{ activity.description }}
                                {% endif %}
                            </div>
                        </div>
                        <div style="text-align: right; flex-shrink: 0;">
                            {% assign cost_text = activity.cost | currency %}
                            {% assign cost_length = cost_text | size %}
                            {% if cost_length <= 8 %}
                                {% assign cost_class = "cost-short" %}
                            {% elsif cost_length <= 12 %}
                                {% assign cost_class = "cost-medium" %}
                            {% else %}
                                {% assign cost_class = "cost-long" %}
                            {% endif %}
                            <div class="classification-font {{ cost_class }}" style="color: var(--color-text-alert); font-weight: 600; white-space: nowrap;" aria-labelledby="activity-{{ forloop.index }}">
                                {{ cost_text }}
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
            
            <!-- Authority Footer -->
            <div style="display: flex; flex-direction: column; gap: 12px; padding-top: 16px; border-top: 1px solid var(--color-neutral-200);">
                <div class="standard-font mobile-title-case" style="color: var(--color-text-secondary); font-size: clamp(10px, 2.5vw, 12px); letter-spacing: 0.05em;">
                    /// Taxpayer Funded Activity ///
                </div>
                
                <!-- Sources (Mobile optimized) -->
                {% if expenditure.source_urls %}
                    <div style="display: flex; flex-wrap: wrap; gap: 8px; align-items: center;">
                        <div class="standard-font" style="color: var(--color-text-secondary); font-size: 10px; opacity: 0.7;">
                            SOURCES:
                        </div>
                        {% for source in expenditure.source_urls %}
                            {% assign domain = source | replace: 'https://', '' | replace: 'http://', '' | split: '/' | first %}
                            <a href="{{ source }}" target="_blank" rel="noopener" 
                               style="color: var(--color-text-secondary); text-decoration: none; opacity: 0.6; transition: opacity 0.2s ease; padding: 4px; min-height: 32px; display: flex; align-items: center;"
                               onmouseover="this.style.opacity='1';" onmouseout="this.style.opacity='0.6';"
                               title="{{ domain }}">
                               <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                   <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                               </svg>
                            </a>
                        {% endfor %}
                    </div>
                {% endif %}
                
                <!-- Share Actions -->
                <div style="display: flex; justify-content: space-between; align-items: center; gap: 12px;">
                    <div style="display: inline-block; background: var(--color-bg-secondary); border: 1px solid var(--color-text-secondary); padding: 4px 8px;">
                        <div class="classification-font" style="color: var(--color-text-secondary); font-size: 10px; letter-spacing: 0.1em;">
                            FOR OFFICIAL USE ONLY
                        </div>
                    </div>
                    
                    <!-- Mobile-optimized share buttons -->
                    <div style="display: flex; gap: 8px;">
                        <button onclick="shareExpenditure(this)" 
                                class="share-btn-primary standard-font" 
                                style="color: var(--color-text-primary); background: var(--color-bg-secondary); font-size: clamp(10px, 2.5vw, 12px); padding: 8px 12px; border: 1px solid var(--color-text-secondary); letter-spacing: 0.05em; font-weight: 500; cursor: pointer; transition: all 0.2s ease; min-height: 32px;"
                                data-share-url="https://trumptaxburden.com/day/{{ expenditure.date | date: '%Y/%m/%d' }}/"
                                data-share-title="{{ expenditure.date | date: '%B %-d, %Y' }} - Trump Cost {{ expenditure.total_cost | currency }}"
                                title="Share this expenditure record">
                            SHARE
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</details>

<style>
/* Mobile container and grid */
@media (max-width: 768px) {
    .mobile-container {
        padding: 48px 16px 0 !important; /* 16px gutters, 24px margins equivalent */
    }
    
    .expenditure-card {
        margin-bottom: 16px !important; /* 16px gutters between cards */
    }
    
    /* Single column grid enforced */
    .expenditure-card {
        width: 100%;
        max-width: none;
    }
    
    /* Better grid layout for mobile */
    .expenditure-card .expenditure-details [style*="grid-template-columns: 1fr auto"] {
        grid-template-columns: 1fr max-content;
        gap: clamp(4px, 1vw, 8px);
    }
}

/* Mobile responsive typography with clamp() */
.mobile-title-case {
    font-size: clamp(14px, 4vw, 16px);
}

@media (max-width: 768px) {
    .mobile-title-case {
        text-transform: none !important;
    }
    
    .mobile-title-case::first-letter {
        text-transform: uppercase;
    }
    
    /* Typography scaling */
    .command-font {
        font-size: clamp(20px, 5vw, 28px) !important;
    }
    
    .standard-font {
        font-size: clamp(14px, 4vw, 16px) !important;
    }
    
    .classification-font {
        font-size: clamp(16px, 4vw, 20px) !important;
    }
}

/* Accordion animation */
.expenditure-card {
    transition: all 0.25s ease;
    position: relative;
    isolation: isolate; /* Creates a new stacking context */
    transform: translateZ(0); /* Force hardware acceleration */
    will-change: contents; /* Hint browser about changes */
}

.expenditure-card[open] .chevron {
    transform: rotate(180deg);
}

.expenditure-card[open] {
    transform: translateZ(0) translateY(0.001px); /* Force repaint on open */
}

.expenditure-card:not([open]) .expenditure-details {
    display: none;
}

/* Fix for red line artifact - proper stacking */
.expenditure-card summary {
    position: relative;
    z-index: 2;
    background: var(--color-bg-primary);
}

.expenditure-details {
    position: relative;
    z-index: 1;
    background: var(--color-bg-primary);
}

/* Motion respect */
@media (prefers-reduced-motion: reduce) {
    .expenditure-details,
    .chevron {
        transition: none;
    }
}

/* Price pill styling */
.price-pill {
    flex-shrink: 0;
}

/* Tap target improvements */
.expenditure-summary {
    min-height: 48px;
    padding-block: 12px;
}

/* Remove webkit details marker */
.expenditure-card summary::-webkit-details-marker {
    display: none;
}

.expenditure-card summary::marker {
    display: none;
}

/* Focus states */
.expenditure-card summary:focus {
    outline: 2px solid var(--color-text-alert);
    outline-offset: 2px;
}

.expenditure-card summary:focus:not(:focus-visible) {
    outline: none;
}

.expenditure-card[open] summary:focus {
    outline: none !important;
}

button:focus {
    outline: 2px solid var(--color-text-alert);
    outline-offset: 2px;
}

/* Hover states for better affordances */
.expenditure-summary:hover {
    background-color: var(--color-bg-secondary);
}

.expenditure-summary::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 24px;
    right: 24px;
    height: 1px;
    background: var(--color-neutral-200);
    z-index: 1;
}

.expenditure-card[open] .expenditure-summary::after {
    display: none !important;
    visibility: hidden !important;
}
/* Currency amount size classes */
.cost-short {
    font-size: 16px;
}

.cost-medium {
    font-size: 14px;
}

.cost-long {
    font-size: 12px;
}

/* Component container query setup */
.expenditure-details {
    container-type: inline-size;
    container-name: expenditure-details;
}

/* Classification font sizing with container queries - for card components */
.expenditure-details .classification-font {
    /* Viewport fallback for older browsers */
    font-size: clamp(1rem, 4vw, 1.4rem);
}

/* Container query enhancement for modern browsers - scoped to expenditure details */
@supports (font-size: 1cqi) {
    .expenditure-details .classification-font.cost-short {
        font-size: clamp(1.2rem, 6cqi, 1.8rem);
    }
    
    .expenditure-details .classification-font.cost-medium {
        font-size: clamp(1rem, 5cqi, 1.6rem);
    }
    
    .expenditure-details .classification-font.cost-long {
        font-size: clamp(0.9rem, 4cqi, 1.4rem);
    }
}

/* Fallback for browsers without container query support - scoped to expenditure details */
@supports not (font-size: 1cqi) {
    .expenditure-details .classification-font.cost-short {
        font-size: clamp(1.2rem, 4vw, 1.6rem);
    }
    
    .expenditure-details .classification-font.cost-medium {
        font-size: clamp(1rem, 3.5vw, 1.4rem);
    }
    
    .expenditure-details .classification-font.cost-long {
        font-size: clamp(0.9rem, 3vw, 1.2rem);
    }
}

/* Price pill specific sizing */
.price-pill.cost-short {
    font-size: 14px;
}

.price-pill.cost-medium {
    font-size: 12px;
}

.price-pill.cost-long {
    font-size: 10px;
}

/* Enhanced responsive breakpoints */
@media (max-width: 768px) {
    .cost-short {
        font-size: 14px;
    }
    
    .cost-medium {
        font-size: 12px;
    }
    
    .cost-long {
        font-size: 10px;
    }
    
    .price-pill.cost-short {
        font-size: 12px;
    }
    
    .price-pill.cost-medium {
        font-size: 10px;
    }
    
    .price-pill.cost-long {
        font-size: 9px;
    }
}

@media (max-width: 480px) {
    .cost-short {
        font-size: 12px;
    }
    
    .cost-medium {
        font-size: 10px;
    }
    
    .cost-long {
        font-size: 9px;
    }
    
    .price-pill.cost-short {
        font-size: 10px;
    }
    
    .price-pill.cost-medium {
        font-size: 9px;
    }
    
    .price-pill.cost-long {
        font-size: 8px;
    }
}

@media (max-width: 360px) {
    .cost-short {
        font-size: 10px;
    }
    
    .cost-medium {
        font-size: 9px;
    }
    
    .cost-long {
        font-size: 8px;
    }
    
    .price-pill.cost-short {
        font-size: 9px;
    }
    
    .price-pill.cost-medium {
        font-size: 8px;
    }
    
    .price-pill.cost-long {
        font-size: 7px;
    }
}
</style>

<script>
// Lazy loading for expanded content
document.addEventListener('DOMContentLoaded', function() {
    const cards = document.querySelectorAll('.expenditure-card');
    
    cards.forEach((card, index) => {
        // First card open by default
        if (index === 0) {
            card.setAttribute('open', '');
        }
        
        card.addEventListener('toggle', function() {
            if (this.hasAttribute('open')) {
                // Lazy load content here if needed
                // For now, content is already present
            }
        });
    });
});

// Share functionality
function shareExpenditure(button) {
    const data = {
        title: button.dataset.shareTitle,
        text: button.dataset.shareText,
        url: button.dataset.shareUrl
    };
    
    if (navigator.share) {
        navigator.share(data);
    } else {
        // Fallback: copy to clipboard
        navigator.clipboard.writeText(data.url).then(() => {
            const originalText = button.textContent;
            button.textContent = 'COPIED!';
            setTimeout(() => {
                button.textContent = originalText;
            }, 2000);
        });
    }
}
</script>